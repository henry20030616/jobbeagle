# PDF 下載功能使用指南

## 功能概述

JobBeagle 現在支援將分析報告下載為 **高質量 PDF 文件**，完整保留網頁的深色背景、圖表顏色和排版樣式。

## 技術實現

### 使用的技術棧

1. **html2canvas** - 將 HTML 元素轉換為 Canvas 圖像
2. **jsPDF** - 將 Canvas 圖像轉換為 PDF 文件

### 關鍵特性

✅ **保留深色背景** - PDF 中完整保留 `slate-950` (#020617) 深色主題  
✅ **保留圖表顏色** - 匹配度圓環圖、所有圖標和色彩完整保留  
✅ **高解析度** - 使用 2x scale 提供清晰的文字和圖表  
✅ **自動分頁** - 長報告自動分頁，確保內容完整  
✅ **A4 格式** - 標準 A4 尺寸（210mm x 297mm）  
✅ **智能壓縮** - 自動壓縮 PDF 以減小文件大小  

## 使用方法

### 步驟 1: 生成分析報告
```
1. 填寫職缺資訊
2. 上傳履歷
3. 點擊「啟動 AI 戰略分析」
4. 等待報告生成完成
```

### 步驟 2: 下載 PDF
```
1. 在報告頁面右上角找到「下載 PDF 報告」按鈕
2. 點擊按鈕
3. 等待 PDF 生成（顯示「生成 PDF 中...」）
4. PDF 自動下載到瀏覽器默認下載位置
```

### 文件命名格式
```
JobBeagle_[職位名稱]_[日期].pdf

範例：
JobBeagle_資深軟體工程師_20260118.pdf
```

## 下載過程說明

### 階段 1: 準備階段
- 檢查報告數據完整性
- 生成文件名
- 臨時隱藏下載按鈕（避免在 PDF 中顯示）

### 階段 2: 捕獲階段
- 使用 html2canvas 捕獲整個報告
- 配置選項：
  - `backgroundColor: '#020617'` - 深色背景
  - `scale: 2` - 2倍解析度
  - `useCORS: true` - 允許跨域圖片

### 階段 3: 生成階段
- 創建 jsPDF 實例（A4 格式）
- 將 Canvas 轉換為 PNG 圖像
- 計算分頁（如果內容超過一頁）
- 添加圖像到 PDF

### 階段 4: 下載階段
- 觸發瀏覽器下載
- 顯示成功提示
- 恢復下載按鈕顯示

## 控制台日志

下載過程中會在控制台輸出詳細日志：

```javascript
📄 [PDF] 開始生成 PDF...
✅ [PDF] Canvas 生成成功
✅ [PDF] PDF 生成成功
✅ [PDF] 下載完成: JobBeagle_xxx_20260118.pdf
```

如果出現錯誤：
```javascript
❌ [PDF] 下載報告時發生錯誤: [錯誤詳情]
```

## PDF 內容包含

PDF 文件包含以下完整內容：

### 1. 基本分析
- 🎯 職位標題
- 🏢 公司名稱
- 📍 工作地點
- 💰 薪資範圍
- 📋 職位描述

### 2. 匹配度分析
- 🎯 綜合匹配度（圓環圖）
- ✅ 優勢分析
- ⚠️ 劣勢分析
- 💪 建議改進方向

### 3. 薪資分析
- 💰 市場薪資範圍
- 📊 薪資競爭力
- 📈 薪資增長潛力
- 💡 談判建議

### 4. 公司評價分析
- ⭐ 整體評分
- 👍 優點
- 👎 缺點
- 📝 員工評價

### 5. 市場分析
- 📊 產業趨勢
- 🔥 市場需求
- 🚀 職涯發展前景
- ⚠️ 風險評估

### 6. 面試準備
- 💬 常見面試問題
- 💡 回答建議
- 🎯 準備重點

### 7. 行動計劃
- 📋 短期計劃
- 🎯 中期計劃
- 🚀 長期計劃

## 質量保證

### 解析度
- **Scale: 2x** - 提供清晰的文字和圖表
- **Image Quality: 1.0** - 最高質量的 PNG 圖像

### 顏色保真度
- **深色背景**: `#020617` (slate-950)
- **主要文字**: `#e2e8f0` (slate-200)
- **次要文字**: `#cbd5e1` (slate-300)
- **圖表顏色**: 完整保留原始顏色

### 排版一致性
- 使用原始 HTML 結構和 CSS 樣式
- 保留所有間距和對齊
- 保留圓角、陰影等視覺效果

## 常見問題

### Q1: PDF 文件大小是多少？
**A:** 根據報告內容長度，通常在 **1-3 MB** 之間。使用了自動壓縮技術。

### Q2: 支援哪些瀏覽器？
**A:** 支援所有現代瀏覽器：
- ✅ Chrome/Edge (推薦)
- ✅ Firefox
- ✅ Safari
- ✅ Opera

### Q3: 下載需要多長時間？
**A:** 通常 **3-10 秒**，取決於：
- 報告內容長度
- 設備性能
- 瀏覽器性能

### Q4: PDF 中的圖表清晰嗎？
**A:** 非常清晰！使用了：
- 2x 解析度
- 最高質量的 PNG 格式
- 無損轉換

### Q5: 可以打印 PDF 嗎？
**A:** 可以！PDF 是標準 A4 格式，可以直接打印。  
**注意**: 深色背景會消耗較多墨水，建議使用彩色打印機。

### Q6: PDF 中的文字可以複製嗎？
**A:** PDF 是以圖像形式保存的，文字無法直接複製。  
**替代方案**: 使用 OCR 工具（如 Adobe Acrobat）可以識別文字。

### Q7: 下載失敗怎麼辦？
**A:** 可能的原因和解決方案：
1. **內存不足** - 關閉其他標籤頁
2. **瀏覽器權限** - 允許自動下載
3. **擴展衝突** - 暫時禁用廣告攔截器
4. **報告過長** - 分段查看後再下載

### Q8: 為什麼下載按鈕會消失？
**A:** 下載按鈕在生成 PDF 時會自動隱藏，避免出現在 PDF 中。生成完成後會自動恢復。

### Q9: 可以自定義 PDF 格式嗎？
**A:** 目前使用標準 A4 格式。如需自定義，可以：
- 使用 PDF 編輯器後期編輯
- 提交功能需求

### Q10: PDF 包含所有報告內容嗎？
**A:** 是的！PDF 包含網頁上顯示的所有內容，包括：
- 所有文字內容
- 所有圖表和圖標
- 所有色彩和樣式
- 完整的排版結構

## 優化建議

### 獲得最佳效果
1. **使用 Chrome/Edge** - 渲染效果最佳
2. **等待報告完全加載** - 確保圖表完全顯示
3. **關閉縮放** - 保持瀏覽器 100% 縮放
4. **穩定網絡** - 確保網絡連接穩定

### 如果 PDF 顯示異常
1. 刷新頁面重新生成報告
2. 清除瀏覽器緩存
3. 更新瀏覽器到最新版本
4. 嘗試其他瀏覽器

## 技術細節

### html2canvas 配置
```typescript
{
  backgroundColor: '#020617',  // 深色背景
  scale: 2,                    // 2x 解析度
  useCORS: true,               // 跨域圖片
  logging: false,              // 禁用日志
  foreignObjectRendering: false, // 避免渲染問題
  imageTimeout: 0,             // 無超時限制
  removeContainer: true,       // 清理臨時容器
}
```

### jsPDF 配置
```typescript
{
  orientation: 'portrait',     // 豎向
  unit: 'mm',                  // 毫米單位
  format: 'a4',                // A4 格式
  compress: true,              // 自動壓縮
}
```

### 自動分頁算法
```typescript
const imgWidth = 210;          // A4 寬度
const pageHeight = 297;        // A4 高度
const imgHeight = (canvas.height * imgWidth) / canvas.width;

// 計算需要的頁數
const totalPages = Math.ceil(imgHeight / pageHeight);
```

## 相關文件

- `components/AnalysisDashboard.tsx` - PDF 下載實現
- `package.json` - 依賴包配置

## 更新日誌

### v1.0.0 (2026-01-18)
- ✨ 實現 PDF 下載功能
- ✨ 支援深色背景保留
- ✨ 支援圖表顏色保留
- ✨ 支援自動分頁
- ✨ 支援高解析度輸出
- ✨ 添加下載進度提示

## 未來計劃

- [ ] 支援淺色主題 PDF
- [ ] 支援自定義頁面大小
- [ ] 支援文字可選擇的 PDF
- [ ] 支援批量下載
- [ ] 支援直接打印功能
- [ ] 支援 PDF 加密保護

## 需要幫助？

如果遇到任何問題：
1. 檢查控制台日志（F12）
2. 查看錯誤訊息
3. 嘗試上述排查步驟
4. 聯繫技術支援
