# 歷史記錄功能說明

## 功能概述

系統提供兩個歷史記錄功能，方便用戶快速存取過去的資料：

### 1. 履歷庫 📄
- **位置**：在「2. 您的履歷 (Resume)」區塊的右上角
- **容量**：最多儲存 **5 份履歷**
- **功能**：
  - 快速選擇之前上傳的履歷
  - 查看履歷檔名和上傳時間
  - 刪除不需要的履歷
  - 手動儲存當前履歷

### 2. 近期分析報告 📊
- **位置**：在「啟動 AI 戰略分析」按鈕的正上方
- **容量**：最多儲存 **10 份報告**
- **功能**：
  - 快速查看最近生成的分析報告
  - 顯示職位標題和生成時間
  - 點擊即可重新查看完整報告

## 時間格式

所有記錄都顯示詳細的時間戳記，格式為：
```
YYYY/M/D HH:MM
```

**範例：**
- `2026/1/17 21:30`
- `2026/1/18 9:05`

## 使用方式

### 履歷庫使用流程

1. **上傳履歷**
   - 選擇 PDF 或文字檔案
   - 檔案自動顯示在履歷區域

2. **儲存履歷**
   - 點擊「儲存」按鈕
   - 看到「✓ 已儲存!」提示表示成功
   - 履歷會自動加入履歷庫

3. **使用歷史履歷**
   - 點擊「履歷庫」按鈕
   - 選擇想要使用的履歷
   - 履歷會自動載入到表單中

4. **刪除履歷**
   - 在履歷庫中找到要刪除的履歷
   - 點擊右側的 ✕ 按鈕
   - 履歷會立即從列表中移除

### 近期分析報告使用流程

1. **生成報告**
   - 填寫職缺資訊和上傳履歷
   - 點擊「啟動 AI 戰略分析」
   - 等待報告生成完成
   - 報告會自動儲存到「近期分析報告」

2. **查看歷史報告**
   - 點擊「近期分析報告」按鈕
   - 瀏覽報告列表（顯示職位標題和時間）
   - 點擊任一報告即可查看完整內容

3. **報告自動管理**
   - 系統自動保存最近 10 份報告
   - 超過 10 份時，最舊的報告會被自動移除
   - 無需手動刪除

## 技術細節

### 數據存儲

**履歷庫 (resume_history 表)**
```sql
- id: UUID (主鍵)
- user_id: UUID (用戶 ID)
- type: TEXT (檔案類型: 'text' 或 'file')
- content: TEXT (履歷內容)
- mime_type: TEXT (MIME 類型)
- file_name: TEXT (檔案名稱)
- created_at: TIMESTAMPTZ (創建時間)
```

**近期分析報告 (analysis_reports 表)**
```sql
- id: UUID (主鍵)
- user_id: UUID (用戶 ID)
- job_title: TEXT (職位標題)
- job_description: TEXT (職缺描述)
- resume_file_name: TEXT (履歷檔名)
- resume_type: TEXT (履歷類型)
- analysis_data: JSONB (完整報告數據)
- content: TEXT (原始 AI 回應)
- created_at: TIMESTAMPTZ (創建時間)
```

### 權限控制

- ✅ 使用 Row Level Security (RLS)
- ✅ 用戶只能看到自己的履歷和報告
- ✅ 未登入用戶無法存取歷史記錄

### 性能優化

- ✅ 異步載入歷史記錄，不阻塞 UI
- ✅ 自動限制查詢數量（履歷 5 份，報告 10 份）
- ✅ 使用索引加速查詢（created_at, user_id）
- ✅ 靜默失敗，不打斷用戶流程

## 常見問題

### Q: 為什麼我看不到歷史記錄？
**A:** 請確認：
1. 已登入帳號
2. 之前有儲存過履歷或生成過報告
3. 瀏覽器控制台沒有錯誤訊息

### Q: 履歷庫為什麼只能存 5 份？
**A:** 這是為了：
1. 保持列表簡潔，方便快速選擇
2. 減少數據庫存儲壓力
3. 鼓勵用戶使用最新、最相關的履歷

### Q: 報告會永久保存嗎？
**A:** 
- 系統保存最近 10 份報告
- 超過 10 份時，最舊的會被自動移除
- 如需長期保存，請使用「下載儲存報告」功能

### Q: 可以手動刪除報告嗎？
**A:** 
- 目前報告會自動管理（保留最新 10 份）
- 如需刪除特定報告，可以在 Supabase Dashboard 中操作
- 未來版本可能會添加手動刪除功能

### Q: 時間顯示不正確怎麼辦？
**A:** 
- 時間基於瀏覽器的本地時區
- 確認電腦的時區設定正確
- 刷新頁面重新載入數據

## 未來改進計劃

### 短期（1-2 週）
- [ ] 添加報告搜索功能
- [ ] 添加報告標籤/分類
- [ ] 支持匯出多份報告

### 中期（1-2 月）
- [ ] 添加報告比較功能
- [ ] 支持履歷版本管理
- [ ] 添加收藏功能

### 長期（3+ 月）
- [ ] 雲端同步（跨設備）
- [ ] 分享報告給他人
- [ ] 報告統計和分析

## 相關文件

- `components/InputForm.tsx` - 履歷庫和報告列表 UI
- `app/page.tsx` - 主頁面邏輯
- `supabase-schema.sql` - 數據庫結構
- `migrate-add-missing-fields.sql` - 數據庫遷移腳本
